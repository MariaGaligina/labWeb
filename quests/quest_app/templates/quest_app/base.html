{% load static %}

<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" ,chrome="1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{{title}}</title>
		<link rel="stylesheet" href="{% static 'quest_app/css/style-add.css' %}" />
		<link rel="stylesheet" href="{% static 'quest_app/css/burgerMenuStyle.css' %}" />
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	</head>
	<body>
		<div class="wrapper">
			<header class="header">
				<div class="container">
					<div class="navbar__wrap">
						<div class="hamb">
							<div class="hamb__field" id="hamb">
								<span class="bar"></span>
								<span class="bar"></span>
								<span class="bar"></span>
							</div>
						</div>
						<div class="logo">
							<img src="https://cdn-icons-png.flaticon.com/128/619/619700.png" />
						</div>

						<ul class="menu" id="menu">
							<li><a href="auth">Регистрация</a></li>
							<li><a href="#main-page">Главная</a></li>
							<li><a href="#nearZel">Рядом с Зеленоградом</a></li>
							<li><a href="#intoZel">В Зеленограде</a></li>

							<li><a href="#contats">Контакты</a></li>
						</ul>
					</div>
				</div>
			</header>
			<div class="popup" id="popup"></div>

			<main class="main">
				<div class="describe-content">
					<h1>{{title}}</h1>
				</div>
				{% block content %} {% endblock content %}

				<div class="row">
					<form
						action="{%url 'like-post-view'%}"
						method="POST"
						,
						class="like-form"
						,
						id="{{quest.id}}">
						{% csrf_token %}
						<input type="hidden" name="post_id" value="{{quest.id}}" />
						<button type="submit" class="ui button like-btn{{quest.id}}">
							{% if user not in quest.likes.all %} Like {% else %} Unlike {% endif %}
						</button>
						<div class="like-count{{quest.id}}">{{quest.num_likes}}</div>
					</form>
				</div>
			</main>

			<footer class="footer">
				<div class="footer-copy" id="contats">Contacts 2023</div>
				<div class="footer-text">Права защищены</div>
			</footer>
		</div>
		<script src="{%static 'quest_app/js/burgerMenuScript.js' %}"></script>
	</body>
	{%block scripts %}
	<script>
		$( document ).ready(function() {

		    $('.like-form').submit(function(e){
		        e.preventDefault()

		        const post_id = $(this).attr('id')

		        const likeText = $(.like-btn${post_id}).text()
		        const trim = $.trim(likeText)

		        const url = $(this).attr('action')

		        let res;
		        const likes = $(.like-count${post_id}).text()
		        const trimCount = parseInt(likes)

		        $.ajax({
		            type: 'POST',
		            url: url,
		            data: {
		                'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
		                'post_id':post_id,
		            },
		            success: function(response) {
		                if(trim === 'Unlike') {
		                    $(.like-btn${post_id}).text('Like')
		                    res = trimCount - 1
		                } else {
		                    $(.like-btn${post_id}).text('Unlike')
		                    res = trimCount + 1
		                }

		                $(.like-count${post_id}).text(res)
		            },
		            error: function(response) {
		                console.log('error', response)
		            }
		        })
		    })

		});
	</script>
	{%endblock scripts%}
</html>
